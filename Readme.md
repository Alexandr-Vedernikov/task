# Тестовое задание для соискателя на вакансию уровня «Специалист»

---

## Задание 1

1. В корпоративной сети развернуты 30 серверов Ubuntu 18.04, 12 серверов CentOS 7.6 и 4 сервера Ubuntu 20.04. К каждому 
из них есть доступ по ssh под локальной УЗ user01, на каждом сервере данному пользователю предоставлено право входа с 
повышенными привилегиями (sudo). Доменной аутентификации для данных серверов не предусмотрено. Пароль известен рабочей 
группе администраторов со сменным графиком, в которую входите и Вы. В зону ответственности Вашей рабочей группы входят 
в том числе и указанные выше серверы. Вы работаете в дневную смену, и выясняете, что на одном сервере Ubuntu были 
внесены изменения в настройки межсетевого экрана. Время изменений – 5 часов назад, т.е. во время предыдущей смены. 
Ваш коллега не отвечает по телефону – вероятно, отсыпается. Никакой информации о своих действиях он Вам не передавал. 
Требуется собрать информацию о том, на каких серверах из перечисленных выше производились изменения под указанной 
учетной записью. 

Решение:

- Создаем файл "inventory.env" для последующей работы ansible.  
С помощью скрипта создаем список ip адресов на которых работают сервера. Сканирование проходит по сети с маской /24. 
Для запуска скрипта нужно указать параметр в виде первых 3-х блоков ip v4.   
Пример запуска: sh [create_inventory.sh](Task1%2Fcreate_inventory.sh) 192.168.1  
Скрипт просканирует сеть 192.168.1.0/24 и те ip которые ответят запишутся в файл "inventory.env".


- На втором этапе нужно зайти в файл [find.yml](Task1%2Ffind.yml) и поправить переменные в шапке. 
````
    #Имя искомого пользователя
    username: "vagrant"
    #Искомая дата входа на хосты пользователя. Дама в формате YYYY-MM-DD
    date: "2023-03-21"
````
Для запуска: ansible-playbook -i inventory.env [find.yml](Task1%2Ffind.yml)  
Данный ansible-playbook выполняет поиск хостов на которые логинился искомый пользователь в указанную дату. IP получены 
из пункта выше. В результате выполнения playbook получем на выходе файл out_ip.txt со списком IP адресов на которых 
логинился пользователь. В зависимости от того что он изменил в настройках firewall и как это отразилось в логах, можно 
такой уникальный признак поискать c помощью ansibl. Только в данном случае запустить ansible с ключем "-i out_ip.txt".


## Задание 2

Пользователи внутреннего веб-сервиса https://internalservice.domain.org (192.168.0.3) жалуются на существенное снижение 
производительности. Сервис представляет собой веб-сервер apache с локальным хранилищем. Попытавшись подключиться к 
сервису, Вы убеждаетесь, что на этот раз пользователи не вводят Вас в заблуждение. Вы пытаетесь определить причину 
снижения производительности. Для этого входите в систему по ssh на 192.168.0.3 и запускаете top. В выводе данной 
утилиты Вы видите:  
````
load average: 0,05, 0,07, 0,01
…….
MiB Mem :  16008,2 total,   4042,3 free,   …..
MiB Swap:   1962,0 total,   541,0 free,     ……
````
Укажите вероятные причины снижения производительности веб-сервера 192.168.0.3.

Решение:

Судя по тому, что load averadge (LA) очень низкий, значит сервер почти простаивает. 
Причины:  
1) Либо сервер хоть и востребован пользователями, но при этом он может не получать пакеты с запросами от них.

  - Начнем по порядку. Нужно посмотреть доступность Веб-сервера. Запустить ping https://internalservice.domain.org (Инменно 
по url адресу.) Посмотрим сможет DNS правильно отработать и дать ответ ввиде 192.169.0.3. Если нет, тогда смотрим 
настройки DNS.
DNS отработал и пошел процесс "пингования" сервера. Смотрим на TTL и на time. Если TTL не постоянно и/или time 
несколько сотен или тысяч ms. Тогда нужно посмотреть несколько моментов:
  - если в сети не один DHCP, тогда убедиться чтобы один адрес не был выдан нескольким хостам.  
  - Запустить "tractroute 192.169.0.3". Нужно исключить наличие "сетевых петель", оптимальность маршрута и 
доступность сетевых узлов. Желательно отдать предпочтение динамическим протоколам маршрутизации, особенно в 
разветвленных сетях.  
Все эти факторы отвечают за доступность в рамках сетевой инфраструктуры.   

2) Возможен вариант, что сервер не так востребован поэтому нет частых запросов. Но при этом выгрузка данных из 
хранилища просела по скорости. Остальные ресурсы сервера в наличии (CPU, RAM, Swap).  
 - Необходимо посмотреть есть место на дисках "df -h". Возможно закончилось место.  
 - Если место есть нужно посмотреть наличие inode "df -i". Если inode закончились тогда ОС не сможет записывать файлы 
на диск. Нужно определить процесс, который генерирует много мелких файлов и директорию с ними. Процесс можно "прибить" 
и собрать о нем информацию (родительский процесс, его функционал, кто и когда его запустил). По итогу принимается 
решение по дальнейшей его судьбе. 
 - дальше нужно проверить RAID. возможно у нас в RAID появились вышедшие из строя диски. ЕСли так тогда нужно решить 
вопрос с заменой диска.  
 - Если RAID аппаратный нужно еще посмотреть работоспособность "железного" контроллера. Возможно он вышел из строя.  


## Задание 3

Вам требуется на серверы из п.1. установить ПО, размещенное в локальных корпоративных репозиториях. Все репозитории 
уже подключены на всех серверах в корпоративной сети. Пакет для Ubuntu называется package2, пакет для CentOS 
называется pckg02.  Вы подозреваете, что в течение ближайших 2 месяцев возможен выпуск обновленных версий данных 
пакетов с теми же именами. Требуется установить пакеты на серверы и подготовиться к повторной (или даже многократной) 
установке/переустановке пакетов на серверы. Опишите свои действия.

Решение:

Так как данная процедура будет выполняться много раз даже в рамках одной итерации, а мы предполагаем что итераций 
точно будет несколько, тогда данную процедуру нужно автоматизировать. 
Т.к. на всех серверах уже подключены репозитории, тогда задача сводится к определению типа ОС. 
Для установки приложения можно воспользоваться playbook [soft_install.yml](Task3%2Fsoft_install.yml). А в качестве 
списка IP адресов с работающими серверами из пункта 1.  
Команда для запуска процесса: ansible-playbook -i ../Task1/inventory.env [soft_install.yml](Task3%2Fsoft_install.yml)



